set logfile /Users/suhlig/workspace/nginx-timeout-spike/log/monit.log
set pidfile /Users/suhlig/workspace/nginx-timeout-spike/monit.pid
set daemon 60
set httpd port 2812
  allow localhost

check process puma
  with pidfile /Users/suhlig/workspace/nginx-timeout-spike/puma.pid

  start program = "/Users/suhlig/workspace/nginx-timeout-spike/bin/puma_ctl start"
  stop program  = "/Users/suhlig/workspace/nginx-timeout-spike/bin/puma_ctl stop"

  if totalmem > 300.0 MB for 5 cycles then restart
  if cpu usage > 95% for 5 cycles then restart

check process nginx
  with pidfile /Users/suhlig/workspace/nginx-timeout-spike/nginx.pid

  start program = "/Users/suhlig/workspace/nginx-timeout-spike/bin/nginx_ctl start"
  stop program  = "/Users/suhlig/workspace/nginx-timeout-spike/bin/nginx_ctl stop"

  if totalmem > 100.0 MB for 5 cycles then restart
  if cpu usage > 95% for 5 cycles then restart
